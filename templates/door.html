<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Door Display</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"
        integrity="sha384-mZLF4UVrpi/QTWPA7BjNPEnkIfRFn4ZEO3Qt/HFklTJBj/gBOV8G3HcKn4NfQblz"
        crossorigin="anonymous"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #121212;
        }

        .car-container {
            position: relative;
            width: 300px;
            height: 400px;
            background: linear-gradient(to bottom, #0f0f0f, #1f1f1f);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            margin: 0 auto;
            padding: 10px;
            box-sizing: border-box;
        }

        .door {
            width: 80px;
            height: 120px;
            background: #3a3a3a;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.5s ease, box-shadow 0.1s ease;
            /* 부드러운 변화 추가 */
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .door.open {
            box-shadow: 0 0 15px 5px yellow;
            border-color: yellow;
        }

        .door:hover {
            background: #555;
        }

        .top-row,
        .bottom-row {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .lock {
            width: 80px;
            height: 40px;
            background: gray;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 14px;
            margin-top: 10px;
            transition: background 0.5s ease, box-shadow 0.3s ease, color 0.5s ease;
            /* 부드러운 변화 추가 */
        }

        .lock.locked {
            background: red;
            box-shadow: 0 0 10px 3px red; /* 번지는 효과를 줄임 */
            color: white;
        }

        .lock.unlocked {
            background: green;
            box-shadow: 0 0 10px 3px green; /* 번지는 효과를 줄임 */
            color: white;
        }

        .lock:hover.locked {
            background: #e04d4d; /* 기존 빨간색보다 약간 밝은 톤 */
            box-shadow: 0 0 7px 3px rgba(224, 77, 77, 0.7); /* 번지는 범위와 투명도 줄임 */
        }

        .lock:hover.unlocked {
            background: #4de04d; /* 기존 초록색보다 약간 밝은 톤 */
            box-shadow: 0 0 7px 3px rgba(77, 224, 77, 0.7); /* 번지는 범위와 투명도 줄임 */
        }

        .power {
            width: 150px;
            height: 50px;
            margin-bottom: 20px;
            background: gray;
            color: white;
            font-size: 16px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-transform: uppercase;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            transition: background 0.5s ease, box-shadow 0.5s ease;
        }

        .power.on {
            background: blue;
            box-shadow: 0 0 15px 5px blue;
        }

        .power.off {
            background: gray;
            box-shadow: 0 0 15px 5px gray;
        }
    </style>


</head>

<body>
    <div class="car-container">
        <div class="power" id="power-status">Power Off</div>
        <div class="top-row">
            <div class="door" id="door-1">Door 1</div>
            <div class="lock" id="lock">Lock</div>
        </div>
        <div class="bottom-row">
            <div class="door" id="door-2">Door 2</div>
            <div class="lock" id="unlock">unLock</div>
        </div>
    </div>

    <script>
        const socket = io.connect();
        socket.on('connect', () => {
            console.log('WebSocket connected');
        });

        socket.on('disconnect', () => {
            console.log('WebSocket disconnected');
        });

        socket.on('initialize', function (doorStates) {
            console.log('Initializing UI with door states:', doorStates);

            for (const doorId in doorStates) {
                const doorLockStatus = doorStates[doorId][0];
                const doorOpenStatus = doorStates[doorId][1];

                const doorElement = document.getElementById(`door-${doorId}`);
                if (doorElement) {
                    if (doorOpenStatus === 1) {
                        doorElement.classList.add("open");
                    } else if (doorOpenStatus === 0) {
                        doorElement.classList.remove("open");
                    }
                } else {
                    console.warn(`Door element with ID door-${doorId} not found.`);
                }

                // const lockElement = document.getElementById(`lock-${doorId}`);
                // if (lockElement) {
                //     if (doorLockStatus === 1) {
                //         lockElement.classList.remove("locked");
                //         lockElement.classList.add("unlocked");
                //         lockElement.textContent = "Unlocked";
                //     } else if (doorLockStatus === 0) {
                //         lockElement.classList.remove("unlocked");
                //         lockElement.classList.add("locked");
                //         lockElement.textContent = "Locked";
                //     }
                // } else {
                //     console.warn(`Lock element with ID lock-${doorId} not found.`);
                // }
            }
        });

        socket.on("handleDoorStatus", function (data) {
            console.log("Door status update:", data);

            const doorId = data.door_id;
            const doorLockStatus = data.door_lock_status;
            const doorOpenStatus = data.door_open_status;

            const doorElement = document.getElementById(`door-${doorId}`);
            // const lockElement = document.getElementById(`lock-${doorId}`);

            if (doorElement) {
                if (doorOpenStatus === 1) {
                    doorElement.classList.add("open");
                } else if (doorOpenStatus === 0) {
                    doorElement.classList.remove("open");
                }
            } else {
                console.warn(`Door element with ID ${doorId} not found.`);
            }

            // if (lockElement) {
            //     if (doorLockStatus === 1) {
            //         lockElement.classList.remove("locked");
            //         lockElement.classList.add("unlocked");
            //         lockElement.textContent = "Unlocked";
            //     } else if (doorLockStatus === 0) {
            //         lockElement.classList.remove("unlocked");
            //         lockElement.classList.add("locked");
            //         lockElement.textContent = "Locked";
            //     }
            // } else {
            //     console.warn(`Lock element with ID lock-${doorId} not found.`);
            // }
        });

        socket.on("digitalKey", function (msg) {
            console.log("Door status update:", msg);

            const doorId = msg.door_id;
            const doorElement = document.getElementById(doorId);
            if (doorElement) {
                doorElement.style.backgroundColor = "yellow";
            } else {
                console.log(`No element found for door_id: ${doorId}`);
            }

        });

        socket.on('powerStatusUpdate', function (data) {
            console.log('Power status updated:', data);

            const powerElement = document.getElementById('power-status');

            if (data.status === 1) {
                powerElement.classList.remove('off');
                powerElement.classList.add('on');
                powerElement.textContent = 'Power On';
            } else if (data.status === 0) {
                powerElement.classList.remove('on');
                powerElement.classList.add('off');
                powerElement.textContent = 'Power Off';
            }
        });

        function getDoorIdFromElement(elementId) {
            return elementId.split('-')[1];
        }

        document.querySelectorAll('.door').forEach(door => {
        door.addEventListener('click', () => {
       
            const doorId = getDoorIdFromElement(door.id); 

            socket.emit('doorCommand', { door_id: doorId });
            });
        });

        document.getElementById('lock').addEventListener('click', () => {
            console.log('lock button clicked'); 
            socket.emit('lockCommand'); 
        });

        document.getElementById('unlock').addEventListener('click', () => {
            console.log('Unlock button clicked'); 
            socket.emit('unlockCommand'); 
        });

        document.querySelectorAll('.power').forEach(door => {
        door.addEventListener('click', () => {
    
            socket.emit('powerCommand', {});
            });
        });

        // Success, Error
        socket.on('doorCommandSuccess', function (data) {
            console.log('Door Command successful:', data);
        });

        socket.on('doorCommandError', function (data) {
            console.error('Door Command failed:', data);
        });

        socket.on('lockCommandSuccess', function (data) {
            console.log('Lock Command successful:', data);
        });

        socket.on('lockCommandError', function (data) {
            console.error('Lock Command failed:', data);
        });

        socket.on('unlockCommandSuccess', function (data) {
            console.log('Lock Command successful:', data);
        });

        socket.on('unlockCommandError', function (data) {
            console.error('Lock Command failed:', data);
        });

        socket.on('powerCommandSuccess', (data) => {
            console.log('Power Command successful:', data);
        });

        socket.on('powerCommandError', (data) => {
            console.error('Power Command failed:', data);
        });


    </script>
</body>

</html>